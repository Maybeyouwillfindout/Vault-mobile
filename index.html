<!doctype html><html lang="de"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vault Mobile v2.4.2 (OCR-Debug)</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head><body>
<header><h1>Vault Mobile v2.4.2 (OCR-Debug)</h1><div id="status">Auto-Login aktiv (PW=test1234)</div></header>
<main class="card">
<h2>Screenshot-Import (OCR – Debug)</h2>
<input type="file" id="img-file" accept="image/*">
<button id="btn-ocr">OCR starten</button>
<pre id="log" class="log"></pre>
<textarea id="raw" rows="8" placeholder="Rohtext…"></textarea>
<table id="tbl"><thead><tr><th>Datum</th><th>Beschreibung</th><th>Betrag</th></tr></thead><tbody id="body"></tbody></table>
<script>
function log(m){const el=document.getElementById('log'); el.textContent+=(el.textContent?'\n':'')+m; el.scrollTop=el.scrollHeight;}
function parseAmount(x){if(typeof x!=='string')return Number(x||0);const n=x.replace(/\s/g,'').replace(/\./g,'').replace(',','.');return parseFloat(n)||0;}
function normalizeDate(s){if(/\d{4}-\d{2}-\d{2}/.test(s))return s;if(/\d{2}[.\/-]\d{2}[.\/-]\d{4}/.test(s)){const [d,m,y]=s.split(/[.\/-]/);return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;}return s;}
function extract(raw){const lines=raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);const out=[];for(const line of lines){let date=null;if(/\d{4}-\d{2}-\d{2}/.test(line))date=line.match(/\d{4}-\d{2}-\d{2}/)[0];else if(/\b\d{2}[.\/-]\d{2}[.\/-]\d{4}\b/.test(line))date=line.match(/\b\d{2}[.\/-]\d{2}[.\/-]\d{4}\b/)[0];const amt=(line.match(/[-+]?\d{1,3}(?:[\.\s]\d{3})*(?:[\.,]\d{2})/)||[null])[0];if(date&&amt){let desc=line.replace(date,'').replace(amt,'').trim();out.push({date:normalizeDate(date),description:desc,amount:parseAmount(amt)});}}return out;}
document.getElementById('btn-ocr').onclick=async()=>{
 const f=document.getElementById('img-file').files[0]; if(!f){log('❌ Kein Bild gewählt.'); return;}
 if(!window.Tesseract){log('❌ Tesseract.js nicht geladen (Internet erforderlich beim ersten Mal).'); return;}
 try{
   log('⏳ OCR startet…');
   const worker=await Tesseract.createWorker('deu+eng',1,{logger:m=>m.status&&log('Tesseract: '+m.status)});
   const res=await worker.recognize(await f.arrayBuffer()); await worker.terminate();
   const raw=(res&&res.data&&res.data.text)||''; document.getElementById('raw').value=raw||'— leer —';
   const rows=extract(raw); log('Gefundene Buchungen: '+rows.length);
   document.getElementById('body').innerHTML=rows.map(r=>`<tr><td>${r.date}</td><td>${r.description}</td><td style='text-align:right'>${r.amount.toFixed(2)}</td></tr>`).join('');
 }catch(e){log('❌ Fehler: '+(e&&e.message?e.message:e));}
};
</script>
</main></body></html>